<!DOCTYPE html>

<html>
 
<head>

<meta charset="UTF-8">

<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

   <title>testkamal</title>

<meta name="description" content=DESCRIPTION>
<meta name="generator" content=META_GENERATOR>

<!-- Apple Stuff -->
<meta name="apple-mobile-web-app-capable" content=APPLE_MOBILE_WEB_APP_CAPABLE>
<meta name="apple-mobile-web-app-status-bar-style" content=APPLE_MOBILE_WEB_APP_STATUS_BAR_STYLE>
<meta name="apple-mobile-web-app-title" content=APPLE_TITLE>

<!-- Google / Search Engine Tags -->
<meta itemprop="name" content=Name>
<meta itemprop="description" content=ITEMPROP_DESCRIPTION>
<meta itemprop="image" content=ITEMPROP_IMAGE>

<!-- MS Tile - for Microsoft apps-->
<meta name="msapplication-TileImage" content=MSAPPLICATION_TILE_IMAGE>

<!-- Facebook Meta Tags -->
<meta property="og:type" content=OG_TYPE>
<meta property="og:title" content=OG_TITLE>
<meta property="og:description" content=OG_DESCRIPTION>
<meta property="og:image" content=OG_MAGE>
<meta property="og:url" content=OG_URL>

<!-- Twitter Meta Tags -->
<meta name="twitter:card" content=TWITTER_CARD>
<meta name="twitter:title" content=Twitter title>
<meta name="twitter:description" content=Twitter Discription>
<meta name="twitter:image" content=TWITTER_IMAGE>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;800;900&family=Comfortaa:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Handlee&family=Josefin+Sans:wght@100;200;300;400;500;600;700&family=Lato:wght@100;300;400;700;900&family=Montserrat:wght@100;200;300;400;500;600;700;800;900&family=Mulish:wght@200;300;400;500;600;700;800;900;1000&family=Nunito:wght@200;300;400;500;600;700;800;900;1000&family=Orbitron:wght@400;500;600;700;800;900&family=Parisienne&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Preahvihear&family=Raleway:wght@100;200;400&family=Roboto:wght@100;300;400;500;700;900&family=Satisfy&family=Tektur:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="icon" type="image/png" href="images/favicon.png">

<script type="application/ld+json">
   {
       "@context":"http://schema.org",
       "@type":"WebPage",
       "url":https://www.shopiana.in,
       "description":DESCRIPITION,
       "name":Shopiana Template ,
       "image":https://www.shopiana.in/assets/imgs/slider/logo/shopiana_dark_logo_2.png
   }
</script>

   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:regular&amp;subset=latin&amp;display=swap"/>
   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:regular,700&amp;subset=latin&amp;display=swap"/>
 
<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<style type="text/css">

* { box-sizing: border-box; } body {margin: 0;}#gjs-payment-address{height:100px;}

</style>

</head>
		<html>
 <head></head>
 <body id="i5mx">
  <form id="i02s" class="mx-5 py-5">
   <div class="row">
    <h2 class="pb-2">Payment form</h2>
    <div class="col-md-6 col-12 mt-md-0 mt-4">
     <label for="gjs-payment-first-name" class="form-label">First Name</label><input type="text" required id="gjs-payment-first-name" placeholder="First name" class="form-control">
    </div>
    <div class="col-md-6 col-12 mt-md-0 mt-4">
     <label for="gjs-payment-last-name" class="form-label">Last Name</label><input type="text" required id="gjs-payment-last-name" placeholder="Last name" class="form-control">
    </div>
    <div class="col-md-6 col-12 mt-4">
     <label for="gjs-payment-email" class="form-label">Email</label><input type="email" required id="gjs-payment-email" placeholder="Enter your email" class="form-control">
    </div>
    <div class="col-md-6 col-12 mt-4">
     <label for="gjs-payment-phone-number" class="form-label">Phone Number </label><input type="number" required name="gjs-payment-phone-number" id="gjs-payment-phone-number" placeholder="Enter your phone number" class="form-control">
    </div>
    <div class="col-md-6 col-12 mt-4">
     <label for="gjs-payment-address" class="form-label">Comment</label><textarea placeholder="Leave a comment here" id="gjs-payment-address" required class="form-control"></textarea>
    </div>
    <div class="mt-4">
     <button type="submit" class="btn btn-primary">Submit</button>
    </div>
   </div>
  </form>
  <script>var props = {"i02s":{"name":"test","target":"_self","method":"POST","emailenable":false,"formType":"PAYMENT_FORM","websiteId":751,"merchantCode":"testkamal23111002","formInitUrl":"https://devapi.shopiana.in/api/v1/website/form/payment/init?store=testkamal23111002","paymentCaputreUrl":"https://devapi.shopiana.in/api/v1/website/form/payment/capture?store=testkamal23111002","formDataurl":"https://devapi.shopiana.in/api/v1/wbWebsite/751/form/formData?store=testkamal23111002"}};
          var ids = Object.keys(props).map(function(id) { return '#'+id }).join(',');
          var els = document.querySelectorAll(ids);
          for (var i = 0, len = els.length; i < len; i++) {
            var el = els[i];
            (function ({
    name,
    target,
    method,
    formDataurl,
    emailenable,
    websiteId,
    merchantCode,
    formInitUrl,
    paymentCaputreUrl,
    formType
  }) {
    const PAYMENT = {
      COD_UPPERCASE: "COD",
      COD: "cod",
      AUTHORIZECAPTURE: "AUTHORIZECAPTURE",
      ONLINEPAYMENT: "ONLINEPAYMENT",
      RAZORPAY: "razorpay",
      RAZORPAY_UPPERCASE: "RAZORPAY",
      PAYMENT_INITIALIZATION: "payment/init",
      INIT: "INIT",
      PRIMARY_CARD: "primary",
      PAYMENT_FAILED: "payment.failed",
      RECEIPT_ORDER: "receipt_order_",
      RAZOR_PAY_SUCCESSFULL: "onRazorPaySuccess",
      SHIPPING: "Shipping",
      SECONDARY_CARD: "secondary"
    }; // const submitButton = this.querySelector('[type=submit]'); // Find the submit button

    if (name) {
      const form = this;
      this.addEventListener('submit', e => {
        e.preventDefault(); // Prevent the default form submission
        // Add Razorpay script dynamically

        const razorpayScript = document.createElement('script');
        razorpayScript.src = 'https://checkout.razorpay.com/v1/checkout.js';
        razorpayScript.async = true; // Append the script to the document's head

        document.head.appendChild(razorpayScript); // Create a new FormData object

        const formData = new FormData(form);
        formData.append('emailEnabled', emailenable);
        formData.append('formName', name);
        formData.append('price', 100);
        console.log(formData); // Perform an API call using fetch and Promises

        fetch(formDataurl, {
          method: "POST",
          // headers: {
          //     'Content-Type': 'application/json',
          // },
          body: formData
        }).then(response => {
          if (response.ok) {
            // API call successful
            return response.json();
          } else {
            // API call failed
            throw new Error('API call failed');
          }
        }).then(formDataResponse => {
          console.log('API response:', formDataResponse); // IF IT IS A SIMPLE DATA FORM NOT A PAYMENT FORM

          if (formType === "SIMPLE_FORM") {
            return;
          } // Define the URL and data for the POST request


          const data = {
            websiteFormId: formDataResponse === null || formDataResponse === void 0 ? void 0 : formDataResponse.id,
            amount: formDataResponse === null || formDataResponse === void 0 ? void 0 : formDataResponse.price,
            websiteId: websiteId,
            integrationKeys: {},
            paymentId: "",
            paymentModule: "wb_razorpay",
            paymentToken: "",
            paymentType: "ONLINEPAYMENT"
          }; // Create headers for the request

          const headers = new Headers();
          headers.append('Content-Type', 'application/json'); // Create the request configuration

          const requestOptions = {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(data)
          };
          fetch(formInitUrl, requestOptions).then(response => {
            if (response.ok) {
              // API call successful
              return response.json();
            } else {
              // API call failed
              throw new Error('API call failed');
            }
          }).then(order => {
            var _a;

            console.log('order.....', order);

            try {
              if (order) {
                console.log('order recived'); // const details = JSON.parse(order.details);

                const details = {}; // razorpay payment options

                const options = {
                  key: (_a = order === null || order === void 0 ? void 0 : order.metadata) === null || _a === void 0 ? void 0 : _a.keyId,
                  amount: details === null || details === void 0 ? void 0 : details.amount,
                  currency: "INR",
                  name: "NJ collections",
                  description: '',
                  image: '',
                  order_id: order === null || order === void 0 ? void 0 : order.paymentToken,
                  receipt: PAYMENT.RECEIPT_ORDER + (order === null || order === void 0 ? void 0 : order.orderId),
                  handler: handlerResponse => {
                    console.log('razorpay response', handlerResponse);
                    const paymentCaptureData = {
                      amount: order === null || order === void 0 ? void 0 : order.amount,
                      integrationKeys: {},
                      paymentId: handlerResponse === null || handlerResponse === void 0 ? void 0 : handlerResponse.razorpay_payment_id,
                      paymentModule: "wb_razorpay",
                      paymentToken: handlerResponse === null || handlerResponse === void 0 ? void 0 : handlerResponse.razorpay_order_id,
                      paymentType: "ONLINEPAYMENT",
                      websiteFormId: formDataResponse === null || formDataResponse === void 0 ? void 0 : formDataResponse.id,
                      websiteId: websiteId,
                      signature: handlerResponse === null || handlerResponse === void 0 ? void 0 : handlerResponse.razorpay_signature,
                      transactionType: PAYMENT.AUTHORIZECAPTURE
                    };
                    const requestOptions = {
                      method: 'POST',
                      headers: headers,
                      body: JSON.stringify(paymentCaptureData)
                    };
                    fetch(paymentCaputreUrl, requestOptions).then(response => {
                      if (response.ok) {
                        // API call successful
                        return response.json();
                      } else {
                        // API call failed
                        throw new Error('API call failed');
                      }
                    }).then(responseData => {
                      console.log('caputre response ', responseData);
                      alert("payment complete successfully...");
                    }).catch(error => {
                      console.log(error);
                    });
                  },
                  prefill: {
                    name: "Akshay ret",
                    email: "test@gmail.com",
                    contact: 7014405637
                  },
                  theme: {
                    color: '#3399cc'
                  }
                };
                console.log(options); // razorpay object initalize

                const rzp1 = new window.Razorpay(options); // init razopay payment window 

                rzp1.open(); // handle

                rzp1.on(PAYMENT.PAYMENT_FAILED, function (response) {
                  alert(response.error.description);
                });
              } else {
                const errorMessage = 'PICKBAZAR_ERROR.SOMETHING_WENT_WRONG'; // toast.error(errorMessage);

                console.log(errorMessage);
              }
            } catch (error) {
              console.log(error);
              debugger;
            }
          }).catch(error => {
            console.error('Error during API call:', error);
          }); // await handlePlaceOrder();
          // Your custom script logic here
        }).catch(error => {
          console.error('Error during API call:', error);
        });
      }); // }
    } else {
      console.log('somthing went wrong');
    }
  }.bind(el))(props[el.id]);
          }</script>
 </body>
</html>
</html>